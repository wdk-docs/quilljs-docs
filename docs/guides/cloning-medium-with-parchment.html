

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>克隆与羊皮纸介质 &mdash; quilljs-docs v2019.10.17 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="设计增量格式" href="designing-the-delta-format.html" />
    <link rel="prev" title="构建定制模块" href="building-a-custom-module.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> quilljs-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../docs/index.html">文档</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="why-quill.html">为什么鹅毛笔</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to-customize-quill.html">如何自定义鹅毛笔？</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-quill-to-your-build-pipeline.html">加入鹅毛笔您构建流水线</a></li>
<li class="toctree-l2"><a class="reference internal" href="building-a-custom-module.html">构建定制模块</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">克隆与羊皮纸介质</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#groundwork">Groundwork</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-quill-core">Adding Quill Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-formatting">Basic Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#links">Links</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blockquote-and-headers">Blockquote and Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dividers">Dividers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#images">Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#videos">Videos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tweets">Tweets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-polish">Final Polish</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="designing-the-delta-format.html">设计增量格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison-with-other-rich-text-editors.html">与其他富文本编辑器比较</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading-to-2-0.html">升级到2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading-to-1-0.html">升级到1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">博客</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">quilljs-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">指南</a> &raquo;</li>
        
      <li>克隆与羊皮纸介质</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/guides/cloning-medium-with-parchment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cloning-medium-with-parchment">
<h1>克隆与羊皮纸介质<a class="headerlink" href="#cloning-medium-with-parchment" title="永久链接至标题">¶</a></h1>
<p>To provide a consistent editing experience, you need both consistent
data and predictable behaviors. The DOM unfortunately lacks both of
these. The solution for modern editors is to maintain their own document
model to represent their contents.
<a class="reference external" href="https://github.com/quilljs/parchment/">Parchment</a> is that solution
for Quill. It is organized in its own codebase with its own API layer.
Through Parchment you can customize the content and formats Quill
recognizes, or add entirely new ones.</p>
<p>In this guide, we will use the building blocks provided by Parchment and
Quill to replicate the editor on Medium. We will start with the bare
bones of Quill, without any themes, extraneous modules, or formats. At
this basic level, Quill only understands plain text. But by the end of
this guide, links, videos, and even tweets will be understood.</p>
<div class="section" id="groundwork">
<h2>Groundwork<a class="headerlink" href="#groundwork" title="永久链接至标题">¶</a></h2>
<p>Let’s start without even using Quill, with just a textarea and button,
hooked up to a dummy event listener. We’ll use jQuery for convenience
throughout this guide, but neither Quill nor Parchment depends on this.
We’ll also add some basic styling, with the help of <a class="reference external" href="https://fonts.google.com/">Google
Fonts</a> and <a class="reference external" href="https://fontawesome.io/">Font
Awesome</a>. None of this has anything to do
with Quill or Parchment, so we’ll move through quickly.</p>
</div>
<div class="section" id="adding-quill-core">
<h2>Adding Quill Core<a class="headerlink" href="#adding-quill-core" title="永久链接至标题">¶</a></h2>
<p>Next, we’ll replace the textarea with Quill core, absent of themes,
formats and extraneous modules. Open up your developer console to
inspect the demo while you type into the editor. You can see the basic
building blocks of a Parchment document at work.</p>
<p>Like the DOM, a Parchment document is a tree. Its nodes, called Blots,
are an abstraction over DOM Nodes. A few blots are already defined for
us: Scroll, Block, Inline, Text and Break. As you type, a Text blot is
synchronized with the corresponding DOM Text node; enters are handled by
creating a new Block blot. In Parchment, Blots that can have children
must have at least one child, so empty Blocks are filled with a Break
blot. This makes handling leaves simple and predictable. All this is
organized under a root Scroll blot.</p>
<p>You cannot observe an Inline blot by just typing at this point since it
does not contribute meaningful structure or formatting to the document.
A valid Quill document must be canonical and compact. There is only one
valid DOM tree that can represent a given document, and that DOM tree
contains the minimal number of nodes.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/p&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;Text&lt;/p&gt;</span></code> represent the
same content, the former is invalid and it is part of Quill’s
optimization process to unwrap the <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>. Similarly, once we add
formatting, <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;&lt;em&gt;Te&lt;/em&gt;&lt;em&gt;st&lt;/em&gt;&lt;/p&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;p&gt;&lt;em&gt;&lt;em&gt;Test&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;</span></code> are also invalid, as they are not the
most compact representation.</p>
<p>Because of these constraints, <strong>Quill cannot support arbitrary DOM trees
and HTML changes</strong>. But as we will see, the consistency and
predicability this structure provides enables us to easily build rich
editing experiences.</p>
</div>
<div class="section" id="basic-formatting">
<h2>Basic Formatting<a class="headerlink" href="#basic-formatting" title="永久链接至标题">¶</a></h2>
<p>We mentioned earlier that an Inline does not contribute formatting. This
is the exception, rather than the rule, made for the base Inline class.
The base Block blot works the same way for block level elements.</p>
<p>To implement bold and italics, we need only to inherit from Inline, set
the <code class="docutils literal notranslate"><span class="pre">blotName</span></code> and <code class="docutils literal notranslate"><span class="pre">tagName</span></code>, and register it with Quill. For a
compelete reference of the signatures of inherited and static methods
and variables, take a look at
<a class="reference external" href="https://github.com/quilljs/parchment/">Parchment</a>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">Inline</span> <span class="o">=</span> <span class="nx">Quill</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;blots/inline&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">BoldBlot</span> <span class="kr">extends</span> <span class="nx">Inline</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">BoldBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">;</span>
<span class="nx">BoldBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;strong&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">ItalicBlot</span> <span class="kr">extends</span> <span class="nx">Inline</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">ItalicBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;italic&#39;</span><span class="p">;</span>
<span class="nx">ItalicBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;em&#39;</span><span class="p">;</span>

<span class="nx">Quill</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">BoldBlot</span><span class="p">);</span>
<span class="nx">Quill</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">ItalicBlot</span><span class="p">);</span>
</pre></div>
</div>
<p>We follow Medium’s example here in using <code class="docutils literal notranslate"><span class="pre">strong</span></code> and <code class="docutils literal notranslate"><span class="pre">em</span></code> tags but
you could just as well use <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">i</span></code> tags. The name of the blot
will be used as the name of the format by Quill. By registering our
blots, we can now use Quill’s full API on our new formats:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Quill</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">BoldBlot</span><span class="p">);</span>
<span class="nx">Quill</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">ItalicBlot</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">quill</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Quill</span><span class="p">(</span><span class="s1">&#39;#editor&#39;</span><span class="p">);</span>

<span class="nx">quill</span><span class="p">.</span><span class="nx">insertText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">bold</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="nx">quill</span><span class="p">.</span><span class="nx">formatText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// If we named our italic blot &quot;myitalic&quot;, we would call</span>
<span class="c1">// quill.formatText(0, 4, &#39;myitalic&#39;, true);</span>
</pre></div>
</div>
<p>Let’s get rid of our dummy button handler and hook up the bold and
italic buttons to Quill’s <code class="docutils literal notranslate"><span class="pre">`format()</span></code> &lt;/docs/api/#format&gt;`__. We will
hardcode <code class="docutils literal notranslate"><span class="pre">true</span></code> to always add formatting for simplicity. In your
application, you can use <code class="docutils literal notranslate"><span class="pre">`getFormat()</span></code> &lt;/docs/api/#getformat&gt;`__ to
retrieve the current formatting over a arbitrary range to decide whether
to add or remove a format. The <a class="reference external" href="/docs/modules/toolbar/">Toolbar</a>
module implements this for Quill, and we will not reimplement it here.</p>
<p>Open your developer console and try out Quill’s <a class="reference external" href="/docs/api/">APIs</a> on
your new bold and italic formats! Make sure to set the context to the
correct CodePen iframe to be able to access the <code class="docutils literal notranslate"><span class="pre">quill</span></code> variable in
the demo.</p>
<p>Note that if you apply both bold and italic to some text, regardless of
what order you do so, Quill wraps the <code class="docutils literal notranslate"><span class="pre">&lt;strong&gt;</span></code> tag outside of the
<code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code> tag, in a consistent order.</p>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="永久链接至标题">¶</a></h2>
<p>Links are slightly more complicated, since we need more than a boolean
to store the link url. This affects our Link blot in two ways: creation
and format retrieval. We will represent the url as a string value, but
we could easily do so in other ways, such as an object with a url key,
allowing for other key/value pairs to be set and define a link. We will
demonstrate this later with <a class="reference external" href="#images">images</a>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">LinkBlot</span> <span class="kr">extends</span> <span class="nx">Inline</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="c1">// Sanitize url value if desired</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="c1">// Okay to set other non-format related attributes</span>
    <span class="c1">// These are invisible to Parchment so must be static</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;_blank&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">formats</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We will only be called with a node already</span>
    <span class="c1">// determined to be a Link blot, so we do</span>
    <span class="c1">// not need to check ourselves</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">LinkBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;link&#39;</span><span class="p">;</span>
<span class="nx">LinkBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>

<span class="nx">Quill</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">LinkBlot</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we can hook our link button up to a fancy <code class="docutils literal notranslate"><span class="pre">prompt</span></code>, again to keep
things simple, before passing to Quill’s <code class="docutils literal notranslate"><span class="pre">format()</span></code>.</p>
</div>
<div class="section" id="blockquote-and-headers">
<h2>Blockquote and Headers<a class="headerlink" href="#blockquote-and-headers" title="永久链接至标题">¶</a></h2>
<p>Blockquotes are implemented the same way as Bold blots, except we will
inherit from Block, the base block level Blot. While Inline blots can be
nested, Block blots cannot. Instead of wrapping, Block blots replace one
another when applied to the same text range.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">Block</span> <span class="o">=</span> <span class="nx">Quill</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;blots/block&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">BlockquoteBlot</span> <span class="kr">extends</span> <span class="nx">Block</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">BlockquoteBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;blockquote&#39;</span><span class="p">;</span>
<span class="nx">BlockquoteBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;blockquote&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Headers are implemented exactly the same way, with only one difference:
it can be represented by more than one DOM element. The value of the
format by default becomes the tagName, instead of just <code class="docutils literal notranslate"><span class="pre">true</span></code>. We can
customize this by extending <code class="docutils literal notranslate"><span class="pre">formats()</span></code>, similar to how we did so for
<a class="reference external" href="#links">links</a>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">HeaderBlot</span> <span class="kr">extends</span> <span class="nx">Block</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">formats</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">HeaderBlot</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">HeaderBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;header&#39;</span><span class="p">;</span>
<span class="c1">// Medium only supports two header sizes, so we will only demonstrate two,</span>
<span class="c1">// but we could easily just add more tags into this array</span>
<span class="nx">HeaderBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>Let’s hook these new blots up to their respective buttons and add some
CSS for the <code class="docutils literal notranslate"><span class="pre">&lt;blockquote&gt;</span></code> tag.</p>
<p>Try setting some text to H1, and in your console, run
<code class="docutils literal notranslate"><span class="pre">quill.getContents()</span></code>. You will see our custom static <code class="docutils literal notranslate"><span class="pre">formats()</span></code>
function at work. Make sure to set the context to the correct CodePen
iframe to be able to access the <code class="docutils literal notranslate"><span class="pre">quill</span></code> variable in the demo.</p>
</div>
<div class="section" id="dividers">
<h2>Dividers<a class="headerlink" href="#dividers" title="永久链接至标题">¶</a></h2>
<p>Now let’s implement our first leaf Blot. While our previous Blot
examples contribute formatting and implement <code class="docutils literal notranslate"><span class="pre">format()</span></code>, leaf Blots
contribute content and implement <code class="docutils literal notranslate"><span class="pre">value()</span></code>. Leaf Blots can either be
Text or Embed Blots, so our section divider will be an Embed. Once
created, Embed Blots’ value is immutable, requiring deletion and
reinsertion to change the content at that location.</p>
<p>Our methodology is similar to before, except we inherit from a
BlockEmbed. Embed also exists under <code class="docutils literal notranslate"><span class="pre">blots/embed</span></code>, but is meant for
inline level blots. We want the block level implementation instead for
dividers.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">BlockEmbed</span> <span class="o">=</span> <span class="nx">Quill</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;blots/block/embed&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">DividerBlot</span> <span class="kr">extends</span> <span class="nx">BlockEmbed</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">DividerBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;divider&#39;</span><span class="p">;</span>
<span class="nx">DividerBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;hr&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Our click handler calls <code class="docutils literal notranslate"><span class="pre">`insertEmbed()</span></code> &lt;/docs/api/#insertembed&gt;`__,
which does not as convienently determine, save, and restore the user
selection for us like <code class="docutils literal notranslate"><span class="pre">`format()</span></code> &lt;/docs/api/#format&gt;`__ does, so we
have to do a little more work to preserve selection ourselves. In
addition, when we try to insert a BlockEmbed in the middle of the Block,
Quill splits the Block for us. To make this behavior more clear, we will
explicitly split the block oursevles by inserting a newline before
inserting the divider. Take a look at the Babel tab in the CodePen for
specifics.</p>
</div>
<div class="section" id="images">
<h2>Images<a class="headerlink" href="#images" title="永久链接至标题">¶</a></h2>
<p>Images can be added with what we learned building the <a class="reference external" href="#links">Link</a>
and <a class="reference external" href="#divider">Divider</a> blots. We will use an object for the value to
show how this is supported. Our button handler to insert images will use
a static value, so we are not distracted by tooltip UI code irrelevant
to <a class="reference external" href="https://github.com/quilljs/parchment/">Parchment</a>, the focus of
this guide.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">BlockEmbed</span> <span class="o">=</span> <span class="nx">Quill</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;blots/block/embed&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">ImageBlot</span> <span class="kr">extends</span> <span class="nx">BlockEmbed</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;alt&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">.</span><span class="nx">alt</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">value</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">alt</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;alt&#39;</span><span class="p">),</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">ImageBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span><span class="p">;</span>
<span class="nx">ImageBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;img&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="videos">
<h2>Videos<a class="headerlink" href="#videos" title="永久链接至标题">¶</a></h2>
<p>We will implement videos in a similar way as we did
<a class="reference external" href="#images">images</a>. We could use the HTML5 <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> tag but we
cannot play YouTube videos this way, and since this is likely the more
common and relevant use case, we will use an <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code> to support
this. We do not have to here, but if you want multiple Blots to use the
same tag, you can use <code class="docutils literal notranslate"><span class="pre">className</span></code> in addition to <code class="docutils literal notranslate"><span class="pre">tagName</span></code>,
demonstrated in the next <a class="reference external" href="#tweet">Tweet</a> example.</p>
<p>Additionally we will add support for widths and heights, as unregistered
formats. Formats specific to Embeds do not have to be registered
separately, as long as there is no namespace collision with registered
formats. This works since Blots just pass unknown formats to its
children, eventually reaching the leaves. This also allows different
Embeds to handle unregistered formats differently. For example, our
<a class="reference external" href="#images">image</a> embed from earlier could have recognized and handled
the <code class="docutils literal notranslate"><span class="pre">width</span></code> format differently than our video does here.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">VideoBlot</span> <span class="kr">extends</span> <span class="nx">BlockEmbed</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
    <span class="c1">// Set non-format related attributes with static values</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;frameborder&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;allowfullscreen&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">formats</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We still need to report unregistered embed formats</span>
    <span class="kd">let</span> <span class="nx">format</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">format</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">format</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">format</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">value</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">format</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle unregistered embed formats</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;height&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;width&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kr">super</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">VideoBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;video&#39;</span><span class="p">;</span>
<span class="nx">VideoBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;iframe&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Note if you open your console and call
<code class="docutils literal notranslate"><span class="pre">`getContents</span></code> &lt;/docs/api/#getcontents&gt;`__, Quill will report the
video as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">ops</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">insert</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">video</span><span class="o">:</span> <span class="s1">&#39;https://www.youtube.com/embed/QHH3iSeDBLo?showinfo=0&#39;</span>
    <span class="p">},</span>
    <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;170&#39;</span><span class="p">,</span>
      <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;400&#39;</span>
    <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tweets">
<h2>Tweets<a class="headerlink" href="#tweets" title="永久链接至标题">¶</a></h2>
<p>Medium supports many embed types, but we will just focus on Tweets for
this guide. The Tweet blot is implemented almost exactly the same as
<a class="reference external" href="#images">images</a>. We take advantage of the fact that Embed blots do
not have to correspond to a void node. It can be any arbitrary node and
Quill will treat it like a void node and not traverse its children or
descendants. This allows us to use a <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> and the native Twitter
Javascript library to do what it pleases within the <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> container
we specify.</p>
<p>Since our root Scroll Blot also uses a <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>, we also specify a
<code class="docutils literal notranslate"><span class="pre">className</span></code> to disambiguate. Note Inline blots use <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> and
Block Blots use <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code> by default, so if you would like to use these
tags for your custom Blots, you will have to specify a <code class="docutils literal notranslate"><span class="pre">className</span></code> in
addition to a <code class="docutils literal notranslate"><span class="pre">tagName</span></code>.</p>
<p>We use the Tweet id as the value defining our Blot. Again our click
handler uses a static value to avoid distraction from irrelevant UI
code.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">TweetBlot</span> <span class="kr">extends</span> <span class="nx">BlockEmbed</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
    <span class="c1">// Allow twitter library to modify our contents</span>
    <span class="nx">twttr</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">createTweet</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">value</span><span class="p">(</span><span class="nx">domNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">domNode</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">TweetBlot</span><span class="p">.</span><span class="nx">blotName</span> <span class="o">=</span> <span class="s1">&#39;tweet&#39;</span><span class="p">;</span>
<span class="nx">TweetBlot</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">=</span> <span class="s1">&#39;div&#39;</span><span class="p">;</span>
<span class="nx">TweetBlot</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;tweet&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="final-polish">
<h2>Final Polish<a class="headerlink" href="#final-polish" title="永久链接至标题">¶</a></h2>
<p>We began with just a bunch of buttons and a Quill core that just
understands plaintext. With Parchment, we are able to add bold, italic,
links, blockquotes, headers, section dividers, images, videos, and even
Tweets. All of this comes while maintaining a predictable and consistent
document, allowing us to use Quill’s powerful <a class="reference external" href="/docs/api/">APIs</a> with
these new formats and content.</p>
<p>Let’s add some final polish to finish off our demo. It won’t compare to
Medium’s UI, but we’ll try to get close.</p>
<!-- script --><script src="//codepen.io/assets/embed/ei.js"></script><!-- script --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="designing-the-delta-format.html" class="btn btn-neutral float-right" title="设计增量格式" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="building-a-custom-module.html" class="btn btn-neutral float-left" title="构建定制模块" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>